%body
  %header
    %h1 Movies
    %ul.actions
      %li= link_to "New Movie", new_movie_path, class: "new" if policy(@movies).create?

.row
  .col-md-12
    .panel.panel-default
      .panel-heading Search Movies
      .panel-body
        = form_tag(root_path, method: :get) do
          .row
            .col-md-2
              %label
                Text:
                = text_field_tag(:searching_text, params[:searching_text], class: "form-control")
            .col-md-2
              %label
                Category:
                = select_tag(:category, options_from_collection_for_select(@categories, "id", "name", params[:category]), { include_blank: true, class: "form-control" })
            .col-md-2
              %label
                Rating:
                = select_tag(:rating, options_for_select((0..5).map{ |rate| [rate, rate] }, params[:rating]), class: "form-control")
            .col-md-1
              %br/
              = submit_tag("Search", class: "btn btn-info form-control")

.row
  .col-md-12
    %table.table.table-striped
      %thead
        %tr
          %th Movie ID
          %th Title
          %th Content
          %th Category
          %th Rating
          %th Actions
      %tbody
        - @movies.each do |movie|
          %tr
            %td
              %span.badge= movie.id
            %td= link_to movie.title, movie
            %td= movie.text
            %td= movie.category.name
            %td
              - (1..movie.ratings.average(:rate).to_i).each do
                %span.glyphicon.glyphicon-star{ "aria-hidden" => "true" }
            %td
              %label
                Rate
              = select_tag "movie_rating_#{movie.id}", options_for_select((1..5).map{ |rate| [rate, rate] }),
                class: "movie_rating form-control", :"data-movie-id" => "#{movie.id}" if policy(movie).rate?
            %td= link_to "Edit", edit_movie_path(movie),
              class: "edit" if policy(movie).edit?
            %td= link_to "Delete", movie_path(movie),
              method: :delete,
              data: { confirm: "Are you sure you want to delete this movie?"},
              class: "delete" if policy(movie).destroy?
.row
  .col-md-3.col-md-offset-9
    = will_paginate @movies, renderer: BootstrapPagination::Rails